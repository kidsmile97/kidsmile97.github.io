---
---

# 重复代码（Duplicated Code）

代码重复为何不好？往往重复的代码并不会影响程序效率，甚至不会影响程序体积（比如一个依赖内的两个互斥模块，重复代码永远只会被引用其中一个模块的一次）。

这个时候就需要从发展的角度看问题了。重复意味着功能、执行结果的一致，一段代码在某种情况下，需要重复，那么随着迭代，该段代码改动，重复部分是不是也大概率会改动呢？

所以结论应该是：`重复代码不一定不好，但是不重复肯定会更好`。

### 如何定义重复

重复的定义应该是有维度的，而不是相同的代码就是重复。比如：

```JavaScript
function each(arr) {
  let index = 0;
  // ...
}

function find(arr, target) {
  let index = 0;
  // ...
}
```

两个函数都有 `let index = 0;`，但谁都知道它们并不重复，所以在考虑重复代码时，或许可以先让自己对`重复`有一个明确的定义

##### 表达式

表达式应该是重复代码的最小维度，但是什么样的表达式应该被当做重复代码重构呢？

> 有`变更`作用的表达式，而非定义表达式

```JavaScript
// 声明于定义
const multiple = 2;
// 固定变更
const num = multiple * 100;
const num2 = multiple * 123;
// 重构
function dobule(num) {
  return num * 2;
}
const num = dobule(100);
const num2 = dobule(123);
```

##### 代码块

实现一个逻辑的代码块，这个是最常见应该以重复代码重构的内容。

1. 提炼函数。既然该代码块完全重复，直接提炼封装为函数即可。

2. 不能直接提炼，存在细微差别的时候。`抛弃其中代码的运行逻辑，只从输入 -> 输出考虑`，应该如何在不改变结果的前提下，改变语句顺序，提炼相同部分函数
